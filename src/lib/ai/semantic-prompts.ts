/**
 * Промпты для семантического анализа документа
 */

/**
 * Системный промпт для семантического анализа
 */
export const SEMANTIC_ANALYSIS_SYSTEM_PROMPT = `Ты — эксперт по структуре научных работ (дипломы, курсовые, диссертации).

Твоя задача — проанализировать текст документа и определить его семантическую структуру:
- Тип каждой секции (титульный лист, введение, главы, заключение, библиография и т.д.)
- Иерархию заголовков (уровни 1-4)
- Границы секций (с какого по какой параграф)
- Особенности списка литературы

КРИТИЧЕСКИ ВАЖНО для списка литературы:
- Точные границы секции (startParagraph и endParagraph)
- Наличие и формат нумерации
- Язык каждого источника (русский/английский)
- Проблемы форматирования в каждом источнике:
  * missing-nbsp-initials: обычные пробелы вместо неразрывных в инициалах (И. И. Иванов → нужен неразрывный пробел)
  * wrong-quotes: прямые кавычки "" вместо угловых «» (для русских текстов)
  * wrong-dash: длинное тире — вместо среднего –
  * missing-numbering: отсутствует номер записи
  * wrong-numbering-format: формат номера не соответствует стандарту
  * inconsistent-format: формат записи отличается от других

ПРАВИЛА ОПРЕДЕЛЕНИЯ ТИПА СЕКЦИИ:
1. **title** (титульный лист):
   - Первая страница с названием вуза, работы, автором
   - Обычно без абзацного отступа, центрированный текст

2. **abstract** (аннотация/реферат):
   - Краткое описание работы
   - Ключевые слова

3. **toc** (содержание/оглавление):
   - Заголовок "Содержание", "Оглавление"
   - Список разделов с номерами страниц

4. **intro** (введение):
   - Заголовок "Введение"
   - Описание актуальности, целей, задач

5. **chapter** (глава/раздел):
   - Нумерованные заголовки: "1. Название", "1.1 Название"
   - Основной текст работы
   - Может содержать подразделы

6. **conclusion** (заключение):
   - Заголовок "Заключение"
   - Выводы по работе

7. **bibliography** (список литературы):
   - Заголовки: "Список литературы", "Список используемой литературы", "Библиография", "References"
   - Список пронумерованных источников

8. **appendix** (приложение):
   - Заголовок "Приложение А", "Приложение 1"
   - Дополнительные материалы

УРОВНИ ЗАГОЛОВКОВ:
- **level: 1** — главы (ВВЕДЕНИЕ, 1. НАЗВАНИЕ ГЛАВЫ, ЗАКЛЮЧЕНИЕ)
- **level: 2** — подразделы (1.1 Название подраздела)
- **level: 3** — пункты (1.1.1 Название пункта)
- **level: 4** — подпункты (1.1.1.1 Название подпункта)

ВАЖНО:
- Границы секций должны быть ТОЧНЫМИ (не пропускай параграфы)
- Если секция не найдена явно, не придумывай её
- Для библиографии ОБЯЗАТЕЛЬНО указывай все проблемы форматирования
- Возвращай результат строго в формате JSON`;

/**
 * Генерирует пользовательский промпт для анализа
 */
export function createSemanticAnalysisPrompt(
  paragraphs: Array<{ index: number; text: string }>
): string {
  // Формируем компактное представление документа для AI
  const documentText = paragraphs
    .map((p) => `[${p.index}] ${p.text.trim()}`)
    .join("\n\n");

  return `Проанализируй структуру следующего документа.

ДОКУМЕНТ:
---
${documentText}
---

Верни JSON со следующей структурой:
{
  "sections": [
    {
      "type": "intro",
      "level": 1,
      "startParagraph": 5,
      "endParagraph": 10,
      "metadata": {
        "title": "ВВЕДЕНИЕ"
      }
    },
    ...
  ],
  "bibliography": {
    "startParagraph": 45,
    "endParagraph": 60,
    "hasNumbering": false,
    "numberingFormat": null,
    "entries": [
      {
        "paragraphIndex": 45,
        "authors": "Иванов И. И.",
        "title": "Название книги",
        "language": "ru",
        "hasProblems": ["missing-nbsp-initials"],
        "rawText": "Иванов И. И. Название книги. М.: Издательство, 2020. 300 с."
      },
      {
        "paragraphIndex": 46,
        "authors": "Smith J. D.",
        "title": "Book title",
        "language": "en",
        "hasProblems": ["missing-nbsp-initials"],
        "rawText": "Smith J. D. Book title. New York: Publisher, 2019. 250 p."
      }
    ]
  },
  "confidence": 0.95,
  "warnings": ["Не удалось определить точные границы приложения"]
}

ОСОБОЕ ВНИМАНИЕ:
1. Для списка литературы обязательно проверь КАЖДЫЙ источник на проблемы форматирования
2. Инициалы с обычными пробелами (И. И. Иванов, Smith J. D.) → missing-nbsp-initials
3. Прямые кавычки в русском тексте ("текст") → wrong-quotes
4. Отсутствие нумерации в списке литературы → missing-numbering
5. Указывай точные границы параграфов для всех секций`;
}

/**
 * Промпт для повторного анализа библиографии (если нужна более детальная проверка)
 */
export function createBibliographyDetailedPrompt(
  bibliographyText: string
): string {
  return `Проанализируй ДЕТАЛЬНО список литературы на предмет проблем форматирования.

СПИСОК ЛИТЕРАТУРЫ:
---
${bibliographyText}
---

Для КАЖДОГО источника определи:
1. Язык (русский или английский)
2. Авторов и их инициалы
3. Проблемы форматирования:
   - missing-nbsp-initials: есть ли обычные пробелы между инициалами и фамилией
   - wrong-quotes: есть ли прямые кавычки "" вместо угловых «»
   - wrong-dash: есть ли длинное тире — вместо среднего –
   - missing-numbering: отсутствует ли номер записи
   - inconsistent-format: отличается ли формат от других записей

Верни JSON со списком записей и их проблемами.`;
}
