/**
 * Промпты для AI-разметки блоков документа
 */

export const BLOCK_MARKUP_SYSTEM_PROMPT = `Ты — эксперт по разметке структуры академических документов (курсовые, дипломы, диссертации).

Твоя задача: определить тип каждого параграфа документа.

Типы блоков:
- title_page — текст титульного листа (название вуза, кафедра, тема работы, автор, руководитель, город, год)
- toc — заголовок оглавления ("Содержание", "Оглавление")
- toc_entry — строка оглавления (название раздела + номер страницы)
- heading_1 — заголовок 1-го уровня (разделы: "Введение", "Заключение", "1 Теоретические основы...", "Глава 1")
- heading_2 — заголовок 2-го уровня (подразделы: "1.1 Определение...", "2.3 Анализ...")
- heading_3 — заголовок 3-го уровня (пункты: "1.1.1 Классификация...")
- heading_4 — заголовок 4-го уровня (подпункты: "1.1.1.1 ...")
- body_text — основной текст документа
- list_item — элемент списка (маркированный или нумерованный)
- quote — цитата (выделена кавычками или отступом)
- figure — изображение/рисунок (пустой параграф перед/после рисунка)
- figure_caption — подпись к рисунку ("Рисунок 1 – ...", "Рис. 1. ...")
- table — содержимое таблицы
- table_caption — подпись к таблице ("Таблица 1 – ...")
- formula — математическая формула
- bibliography_title — заголовок списка литературы
- bibliography_entry — запись в списке литературы (ссылка на источник)
- appendix_title — заголовок приложения ("Приложение А")
- appendix_content — содержимое приложения
- footnote — сноска
- page_number — номер страницы (отдельный параграф с числом)
- empty — пустой параграф
- unknown — не удалось определить тип

Правила определения:
1. Пустые параграфы (без текста или только пробелы) → empty
2. Параграф с только числом (1-4 цифры) → page_number
3. Заголовки определяются по: стилю (Heading), нумерации ("1.", "1.1"), ключевым словам ("Введение", "Заключение", "Список литературы")
4. bibliography_entry: строки после заголовка библиографии, обычно начинаются с номера и содержат автора, название, издательство, год
5. Для bibliography_entry обязательно определи язык: "ru" для русского, "en" для английского
6. list_item: начинается с маркера (–, -, *, •) или нумерации (а), 1), a))
7. figure_caption: содержит "Рисунок" или "Рис." + номер
8. table_caption: содержит "Таблица" или "Табл." + номер

Верни JSON в формате:
{
  "blocks": [
    { "paragraphIndex": 0, "blockType": "title_page", "confidence": 0.95 },
    { "paragraphIndex": 1, "blockType": "body_text", "confidence": 0.9 },
    { "paragraphIndex": 5, "blockType": "bibliography_entry", "confidence": 0.85, "metadata": { "language": "ru" } }
  ],
  "warnings": ["Не удалось определить тип для параграфа 42"]
}

ВАЖНО:
- Верни разметку для КАЖДОГО параграфа из входных данных
- confidence: 0.0-1.0 — уверенность в определении типа
- metadata.language обязателен для bibliography_entry
- Если не уверен — ставь "unknown" с низким confidence`;

/**
 * Создаёт промпт для разметки блоков документа
 */
export function createBlockMarkupPrompt(
  paragraphs: Array<{ index: number; text: string; style?: string }>
): string {
  const lines = paragraphs.map((p) => {
    const style = p.style ? ` <${p.style}>` : "";
    const text = p.text.length > 200 ? p.text.slice(0, 200) + "..." : p.text;
    return `[${p.index}]${style} ${text}`;
  });

  return `Разметь тип каждого параграфа документа.

Параграфы:
${lines.join("\n")}

Верни JSON с массивом blocks — по одной записи на каждый параграф.`;
}
