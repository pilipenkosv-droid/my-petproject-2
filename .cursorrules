---
description: 
alwaysApply: true
---

# Правила разработки для AI ассистента

## Архитектура проекта

### Структура проекта (Feature-Based Architecture)
- Используется модульная архитектура с изоляцией по фичам
- Каждая фича должна быть самодостаточной и изолированной
- Фичи находятся в `src/features/{feature-name}/`
- Глобальные переиспользуемые компоненты в `src/components/ui/`
- Документация: `docs/architecture.md`

### Принципы модульной архитектуры
1. **Изоляция по фичам**: Компоненты, стили, state и логика фичи должны быть изолированы
2. **Минимизация зависимостей**: Фичи не должны напрямую импортировать компоненты других фич
3. **Переиспользуемые компоненты**: Общие компоненты в `src/components/ui/`
4. **Глобальные стили**: Только в `src/app/globals.css` (tokens, reset, utilities)

## Стили и CSS

### Архитектура стилей
- **Глобальные стили**: Только в `src/app/globals.css` (design tokens, reset, utilities, keyframes)
- **Feature-специфичные стили**: CSS Modules в `features/{feature-name}/styles/`
- **Избегание !important**: Запрещено в глобальных стилях. В feature-модулях только в крайних случаях с комментарием
- **CSS Modules**: Используются для изоляции feature-специфичных стилей
- Документация: `docs/css-architecture.md`

### Правила для стилей
- ✅ Допустимо в `globals.css`: CSS переменные, keyframes, reset стили, глобальные утилиты
- ❌ НЕ допустимо в `globals.css`: Feature-специфичные стили, стили компонентов
- ✅ Использовать CSS Modules для feature-специфичных стилей
- ✅ Использовать Tailwind CSS классы для стилизации компонентов
- ❌ Избегать `!important` - использовать только в крайних случаях с комментарием

## Дизайн-система и цветовые палитры

### Единая цветовая гамма
- **Категорийные палитры**: Использовать категорийные палитры вместо монохромных оттенков для различимости данных
- **Две палитры**: Оранжевая (`data-theme="orange"`) - основная, Синяя (`data-theme="blue"`) - альтернативная
- **7 категорийных цветов**: `--cat-1` до `--cat-7` для каждой палитры
- **Поддержка тем**: Каждая палитра поддерживает светлую и темную тему
- Документация: `docs/design-system.md`

### CSS токены для цветов
- **Категорийные токены**: `--cat-1` до `--cat-7` для данных серий
- **Нейтральные токены**: `--chart-grid`, `--chart-axis`, `--chart-text` для нейтральных элементов графиков
- **Специальные токены**: `--cat-6-fill` для заливки сегмента "Новый лояльный"
- **Определение**: Все токены определены в `src/app/globals.css`
- **Использование**: Через утилиты из `src/lib/chart-colors.ts`

### Утилиты для работы с цветами
- **`chartColor(token)`**: Получение цвета из токена в формате `hsl(var(--token))`
- **`getSegmentColor(segment)`**: Получение цвета для RFM сегмента
- **`getSegmentFillColor(segment)`**: Получение цвета для заливки (градиенты)
- **`getChartNeutralColor(type)`**: Получение нейтральных цветов (grid, axis, text)
- **`getSegmentLineStyle(segment)`**: Получение стилей линий (strokeWidth, strokeDasharray)
- **Расположение**: `src/lib/chart-colors.ts`

### Правила использования цветов
- ✅ **Использовать утилиты**: Всегда использовать функции из `src/lib/chart-colors.ts` вместо хардкода цветов
- ✅ **Использовать токены**: Использовать CSS токены (`--cat-1` до `--cat-7`) для категорийных цветов
- ✅ **Нейтральные цвета**: Использовать `--chart-grid`, `--chart-axis`, `--chart-text` для нейтральных элементов
- ✅ **Поддержка тем**: Обеспечивать корректную работу в светлой и темной теме
- ✅ **Градиенты**: Использовать `getSegmentFillColor` для градиентов в графиках
- ✅ **Стили линий**: Использовать `getSegmentLineStyle` для штриховых паттернов линий
- ❌ **Хардкод цветов**: НЕ использовать хардкод цветов (например, `#ff0000` или `rgb(255, 0, 0)`)
- ❌ **Дублирование токенов**: НЕ создавать локальные цветовые переменные, дублирующие глобальные токены

### Рекомендации от директора по дизайну
- **Единая палитра**: Использовать оранжевую акцентную палитру для активных серий, избегать синего в основной палитре
- **Нейтральные цвета**: Использовать slate/gray для осей, сеток, подписей
- **Типографика**: Стандартизировать шрифты (12px для подписей осей, 0.75rem для текста)
- **Сетки**: Тонкие полупрозрачные сетки (только горизонтальные для линейных трендов)
- **Взаимодействие**: Эффекты наведения с вертикальным курсором, синхронизированные tooltips
- **Анимации**: Плавные переходы ease-out 240–300ms
- **Доступность**: Соответствие WCAG AA для контрастности, видимые focus rings
- **Форматирование**: Единое форматирование чисел через `toLocaleString("ru-RU")`

### Примеры использования цветов
```tsx
// ✅ Правильно - использование утилит
import { getSegmentColor, getSegmentFillColor, getSegmentLineStyle, getChartNeutralColor } from "@/lib/chart-colors"

<Area
  stroke={getSegmentColor("Чемпион")} // Использует --cat-1
  fill="url(#fill-champion)"
  {...getSegmentLineStyle("Чемпион")} // strokeWidth: 2.5
/>

<CartesianGrid stroke={getChartNeutralColor("grid")} strokeOpacity={0.5} />

// ❌ Неправильно - хардкод цветов
<Area stroke="#ff6b35" /> // НЕ использовать!
```

## UI компоненты и библиотеки

### Использование готовых решений
- **shadcn/ui**: Основная библиотека UI компонентов
- **Radix UI**: Примитивы для доступных компонентов
- **Tailwind CSS**: Утилитарные классы для стилизации
- **Стандартизация**: Максимально использовать готовые стандартизированные решения из библиотек
- **Избегание конфликтов**: Не создавать кастомные решения, которые могут конфликтовать с библиотеками

### Рекомендации CTO
- Использовать shadcn/ui + Tailwind + Radix primitives
- Избегать создания кастомных решений, когда есть готовые стандартизированные
- Документация: `docs/Конструктор сценариев/рекомендации-cto-технический-стек.md`

## Технический стек

### Основные технологии
- **Next.js 16** (App Router)
- **React 19.2**
- **TypeScript**
- **Tailwind CSS v4**
- **shadcn/ui** (new-york-v4 registry)
- **Radix UI** (примитивы)

### Сборщик
- **Webpack**: Используется по умолчанию (`npm run dev`)
- **Turbopack**: Доступен через `npm run dev:turbopack`, но имеет проблемы с Tailwind CSS v4
- Документация: `README.md` (раздел "Сборщик")

## Правила разработки

### Общие принципы
1. **Следование архитектуре**: Всегда соблюдать принципы модульной архитектуры
2. **Использование готовых решений**: Предпочитать стандартизированные библиотеки
3. **Избегание !important**: Не использовать без крайней необходимости
4. **Изоляция стилей**: Feature-специфичные стили в CSS Modules
5. **Документация**: Комментировать неочевидные решения

### При работе с компонентами
- Использовать компоненты из `src/registry/new-york-v4/ui/` (shadcn/ui)
- Использовать компоненты из `src/components/ui/` для переиспользуемых глобальных компонентов
- Избегать создания кастомных компонентов, если есть готовые решения
- Следовать паттернам существующих компонентов

### При работе со стилями
- Использовать Tailwind CSS классы для стилизации
- Использовать CSS переменные из `globals.css` для цветов и токенов
- Использовать утилиты из `src/lib/chart-colors.ts` для работы с цветами графиков
- Избегать inline стилей, кроме случаев с динамическими значениями
- Использовать CSS Modules для feature-специфичных стилей
- НЕ использовать хардкод цветов - всегда использовать токены или утилиты

### При работе с состояниями
- Использовать React hooks для локального состояния
- Использовать Zustand для глобального состояния фичи
- Избегать prop drilling - использовать контекст или state management

## Важные файлы для справки

- `docs/architecture.md` - Общая архитектура проекта
- `docs/css-architecture.md` - Архитектура стилей
- `docs/design-system.md` - Дизайн-система, цветовые палитры и рекомендации по дизайну
- `docs/Конструктор сценариев/рекомендации-cto-технический-стек.md` - Рекомендации CTO
- `src/lib/chart-colors.ts` - Утилиты для работы с цветами графиков
- `src/app/globals.css` - CSS токены и глобальные стили
- `README.md` - Общая информация о проекте

## Примеры правильной структуры

### Feature компонент
```
src/features/constructor/components/MyComponent.tsx
src/features/constructor/styles/my-component.module.css
```

### Глобальный компонент
```
src/components/ui/my-component.tsx
```

### Использование стилей
```tsx
// ✅ Правильно - Tailwind классы
<button className="rounded-md bg-primary text-primary-foreground hover:bg-primary/90">

// ✅ Правильно - CSS Modules для feature
import styles from './my-component.module.css'
<div className={styles.container}>

// ❌ Неправильно - inline стили (кроме динамических)
<div style={{ backgroundColor: 'red' }}>

// ❌ Неправильно - !important без комментария
.button { color: red !important; }
```
